<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Web3å¤§èˆªæµ· - èšåˆæŠ•ç ”å·¥å…·å¹³å°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âš“</text></svg>">
  <script>
    (function(){
      try{
        const rm = function(){ document.querySelectorAll('script[src*="evmAsk.js"]').forEach(el=>el.remove()); };
        rm();
        const mo = new MutationObserver(rm);
        mo.observe(document.documentElement, { childList:true, subtree:true });
      }catch(e){}
    })();
  </script>
  <style>
    :root { --bg-app:#020617; --bg-card:#1e293b; --bg-sidebar:#0f172a; --text-main:#f1f5f9; --text-muted:#94a3b8; --accent:#38bdf8; --accent-hover:#0ea5e9; --border:#334155; --radius-md:8px; --radius-lg:12px }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:var(--bg-app);color:var(--text-main);min-height:100vh;line-height:1.6}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    /* Navbar styles moved to styles.css to ensure consistency */
    .btn{padding:.5rem 1rem;border-radius:var(--radius-md);border:1px solid var(--border);background:var(--bg-card);color:var(--text-main);text-decoration:none;font-size:.9rem;font-weight:500;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:.5rem}
    .btn:hover{border-color:var(--accent);color:var(--accent)}
    .btn-primary{background:var(--accent);border-color:var(--accent);color:#0b1120}
    .btn-primary:hover{background:var(--accent-hover);color:#000}
    .hero{padding:4rem 0;text-align:center;background:radial-gradient(circle at top right,#1e293b 0%,#020617 40%)}
    .hero h1{font-size:3rem;font-weight:700;margin-bottom:1rem;background:linear-gradient(135deg,var(--accent),#a855f7);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .hero p{font-size:1.2rem;color:var(--text-muted);max-width:600px;margin:0 auto 2rem}
    .tools-section{padding:4rem 0}
    .section-title{font-size:2rem;font-weight:700;text-align:center;margin-bottom:3rem;color:var(--text-main)}
    .tools-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:2rem;max-width:800px;margin:0 auto}
    .tool-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:2rem;text-align:center;transition:all .3s ease;cursor:pointer}
    .tool-card:hover{border-color:var(--accent);transform:translateY(-4px);box-shadow:0 8px 25px rgba(56,189,248,.15)}
    .tool-icon{font-size:3rem;margin-bottom:1rem}
    .tool-title{font-size:1.5rem;font-weight:600;margin-bottom:1rem;color:var(--text-main)}
    .tool-desc{color:var(--text-muted);margin-bottom:1.5rem}
    .tool-badge{display:inline-block;background:rgba(34,197,94,.15);color:#4ade80;padding:.25rem .75rem;border-radius:20px;font-size:.8rem;font-weight:600}
    .user-info{display:flex;align-items:center;gap:.5rem;color:var(--text-muted);font-size:.9rem}
    .user-role{background:rgba(56,189,248,.15);color:var(--accent);padding:.2rem .6rem;border-radius:12px;font-size:.8rem;font-weight:600}
    .message{padding:1rem;border-radius:var(--radius-md);margin:1rem 0;text-align:center}
    .message-success{background:rgba(34,197,94,.15);border:1px solid rgba(34,197,94,.3);color:#4ade80}
    .message-error{background:rgba(239,68,68,.15);border:1px solid rgba(239,68,68,.3);color:#f87171}
    .message-warning{background:rgba(234,179,8,.15);border:1px solid rgba(234,179,8,.3);color:#facc15}
    @media (max-width:768px){.hero h1{font-size:2rem}.hero p{font-size:1rem}.tools-grid{grid-template-columns:1fr}.nav-content{flex-direction:column;gap:1rem}.nav-actions{flex-wrap:wrap;justify-content:center}}
  </style>
  <style> 
    /* 1. å¼¹çª—å¤§ç›’å­ï¼šå‚ç›´æ’åˆ—ï¼Œé«˜åº¦è‡ªé€‚åº” */ 
    #customModal .modal-box { 
        display: flex !important; 
        flex-direction: column !important; 
        justify-content: flex-start !important; 
        align-items: stretch !important; 
        
        width: 90% !important; 
        max-width: 400px !important; 
        height: auto !important; /* è®©å†…å®¹æ’‘å¼€é«˜åº¦ */ 
        padding: 30px !important; 
        
        background-color: #151a23 !important; 
        border: 1px solid #334155 !important; 
        border-radius: 12px !important; 
    } 

    /* 2. å†…å®¹åŒºåŸŸï¼šç»™ä¸‹æ–¹ç•™å‡ºç©ºé—´ */ 
    #customModal .modal-content { 
        display: block !important; 
        width: 100% !important; 
        margin-bottom: 25px !important; /* æ¨å¼€åº•éƒ¨çš„æŒ‰é’® */ 
        background: transparent !important; 
        padding: 0 !important; 
    } 

    /* 3. JSç”Ÿæˆçš„è¡¨å•å®¹å™¨ */ 
    .login-form-container { 
        display: flex !important; 
        flex-direction: column !important; 
        gap: 20px !important; /* è¾“å…¥æ¡†ä¹‹é—´çš„é—´è· */ 
        width: 100% !important; 
    } 

    /* 4. è¾“å…¥æ¡†ï¼šå¼ºåˆ¶ä¿®å¤é«˜åº¦å’Œè¾¹æ¡†æ¨¡å‹ */ 
    .modal-input { 
        display: block !important; 
        width: 100% !important; 
        height: 44px !important; 
        box-sizing: border-box !important; /* å…³é”®ï¼é˜²æ­¢æ’‘ç ´ */ 
        
        background: #0f1218 !important; 
        border: 1px solid #2d3748 !important; 
        color: white !important; 
        padding: 0 12px !important; 
        border-radius: 8px !important; 
        margin: 0 !important; /* é—´è·ç”± gap æ§åˆ¶ */ 
    } 
    .modal-input:focus { 
        border-color: #3b82f6 !important; 
    } 

    /* 5. æŒ‰é’®åŒºåŸŸï¼šå¼ºåˆ¶å½’ä½ */ 
    #customModal .modal-actions { 
        display: flex !important; 
        justify-content: center !important; 
        gap: 20px !important; 
        margin-top: 0 !important; 
        padding-top: 10px !important; 
        
        position: static !important; /* ä¸¥ç¦ç»å¯¹å®šä½ */ 
        width: 100% !important; 
    } 
    
    /* 6. æŒ‰é’®æœ¬èº« */ 
    #customModal .modal-btn { 
        height: 40px !important; 
        min-width: 110px !important; 
    } 
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="nav-brand">
      <a href="/" style="display: flex; align-items: center; gap: 12px; text-decoration: none;">
        <img src="/logo.png?v=2" alt="Web3 å¤§èˆªæµ· Logo" class="nav-logo" onerror="this.src='/logo.svg'">
        <span class="brand-text">Web3 å¤§èˆªæµ·</span>
      </a>
    </div>
    <div class="nav-links" id="navActions"></div>
  </nav>
  <div class="container"><div id="messageContainer"></div></div>
  <section class="hero">
    <div class="container">
      <h1>Web3å¤§èˆªæµ·</h1>
      <p>èšåˆæŠ•ç ”å·¥å…·å¹³å° - åŠ©åŠ›æ‚¨åœ¨Web3ä¸–ç•Œçš„æ¢ç´¢ä¹‹æ—…</p>
      <div id="heroActions"></div>
    </div>
  </section>
  <section class="tools-section">
    <div class="container">
      <h2 class="section-title">å·¥å…·æ¨¡å—</h2>
      <div class="tools-grid">
        <div class="tool-card" onclick="navigateToTool('ai-invest')">
          <div class="tool-icon">ğŸ¤–</div>
          <h3 class="tool-title">AI æŠ•ç ”åŠ©æ‰‹</h3>
          <p class="tool-desc">æ™ºèƒ½åˆ†æé¡¹ç›®ï¼Œç”Ÿæˆä¸“ä¸šæŠ•ç ”æŠ¥å‘Šï¼ŒåŠ©æ‚¨åšå‡ºæ›´æ˜æ™ºçš„æŠ•èµ„å†³ç­–</p>
          <span class="tool-badge">ä¼šå‘˜ä¸“å±</span>
        </div>
        <div class="tool-card" style="opacity:.6;cursor:not-allowed">
          <div class="tool-icon">ğŸš€</div>
          <h3 class="tool-title">æ›´å¤šå·¥å…·</h3>
          <p class="tool-desc">æŒç»­å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…...</p>
          <span class="tool-badge">å³å°†æ¨å‡º</span>
        </div>
      </div>
    </div>
  </section>
  <script>
    let currentUser = null;
    async function init(){ await checkAuthStatus(); renderNavigation(); renderHeroSection(); }
    async function checkAuthStatus(){
      try{ const r = await fetch('/api/session'); if (!r.ok) { currentUser=null; return; } const d = await r.json(); currentUser = (d && d.loggedIn) ? (d.user||null) : null; }
      catch(e){ currentUser=null; }
    }
    function renderNavigation(){ const nav=document.getElementById('navActions'); if (!currentUser){ nav.innerHTML = '<button class="nav-item" onclick="showLoginModal()">ç™»å½•</button><button class="nav-item" onclick="showRegisterModal()">ç”³è¯·æˆä¸ºä¼šå‘˜</button>'; }
      else { const admin = currentUser.status==='admin' ? '<a href="/admin" class="nav-item">ç®¡ç†åå°</a>' : ''; nav.innerHTML = `<div class="user-info"><span>æ¬¢è¿ï¼Œ${currentUser.username}</span><span class="user-role">${getStatusText(currentUser.status)}</span></div>${admin}<button class=\"nav-item logout-btn\" onclick=\"logout()\">é€€å‡ºç™»å½•</button>`; } }
    function renderHeroSection(){ const hero=document.getElementById('heroActions'); if (!currentUser){ hero.innerHTML = '<button class="btn btn-primary" onclick="showRegisterModal()" style="font-size:1.1rem;padding:.75rem 2rem">å¼€å§‹æ¢ç´¢ä¹‹æ—…</button>'; }
      else if (currentUser.status==='pending'){ hero.innerHTML = '<div class="message message-warning">æ‚¨çš„ä¼šå‘˜ç”³è¯·æ­£åœ¨å®¡æ ¸ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…...</div>'; }
      else if (currentUser.status==='member' || currentUser.status==='admin'){ hero.innerHTML = '<div class="message message-success">æ¬¢è¿å›æ¥ï¼æ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨æ‰€æœ‰å·¥å…·åŠŸèƒ½</div>'; } }
    function getStatusText(s){ const m={pending:'å®¡æ ¸ä¸­',member:'ä¼šå‘˜',admin:'ç®¡ç†å‘˜',blacklisted:'é»‘åå•'}; return m[s]||s; }
    function navigateToTool(p){ if (!currentUser){ showMessage('è¯·å…ˆç™»å½•å¹¶æˆä¸ºä¼šå‘˜','error'); showLoginModal(); return; } if (currentUser.status==='pending'){ showMessage('æ‚¨çš„ä¼šå‘˜ç”³è¯·æ­£åœ¨å®¡æ ¸ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…','warning'); return; } if (currentUser.status==='blacklisted'){ showMessage('æ‚¨çš„è´¦å·å·²è¢«åŠ å…¥é»‘åå•','error'); return; } if (currentUser.status==='member' || currentUser.status==='admin'){ location.href='/' + p; } }
    function showMessage(msg,type){ const c=document.getElementById('messageContainer'); const el=document.createElement('div'); el.className='message message-'+type; el.textContent=msg; c.appendChild(el); setTimeout(()=>{ el.remove(); },5000); }
    function logout(){ fetch('/api/logout',{method:'POST'}).then(()=>{ currentUser=null; renderNavigation(); renderHeroSection(); showMessage('å·²æˆåŠŸé€€å‡ºç™»å½•','success'); }); }
    function showLoginModal(){
      const html = `
        <div class="login-form-container">
          <div class="form-group">
            <label>è´¦å·</label>
            <input id="loginUser" type="text" class="modal-input" placeholder="è¯·è¾“å…¥è´¦å·">
          </div>
          <div class="form-group">
            <label>å¯†ç </label>
            <input id="loginPass" type="password" class="modal-input" placeholder="è¯·è¾“å…¥å¯†ç ">
          </div>
          <div id="loginError" class="error-msg"></div>
        </div>
      `;
      showModal('ç™»å½• / æ³¨å†Œ', html, async () => {
        const u = document.getElementById('loginUser').value;
        const p = document.getElementById('loginPass').value;
        const err = document.getElementById('loginError');
        if (!u || !p) { err.textContent = 'è¯·è¾“å…¥è´¦å·å’Œå¯†ç '; return false; }
        
        const res = await login(u,p);
        if (!res.success) {
             err.textContent = res.message;
             return false;
        }
      });
      
      // å¼ºåˆ¶è®¾ç½®æŒ‰é’®æ–‡å­—
      const confirmBtn = document.getElementById('modalConfirmBtn');
      if(confirmBtn) confirmBtn.innerText = "ç™»å½•";
    }
    function showRegisterModal(){
      const html = `
        <div class="login-form-container">
          <div class="form-group">
            <label>è´¦å· (6-8ä½å­—æ¯æˆ–æ•°å­—)</label>
            <input id="regUser" type="text" class="modal-input" placeholder="è¯·è¾“å…¥è´¦å·">
          </div>
          <div class="form-group">
            <label>å¯†ç  (8ä½)</label>
            <input id="regPass" type="password" class="modal-input" placeholder="è¯·è¾“å…¥å¯†ç ">
          </div>
          <div id="regError" class="error-msg"></div>
        </div>
      `;
      showModal('ç”³è¯·ä¼šå‘˜', html, async () => {
        const u = document.getElementById('regUser').value;
        const p = document.getElementById('regPass').value;
        const err = document.getElementById('regError');
        if (!u) { err.textContent = 'è¯·è¾“å…¥è´¦å·'; return false; }
        if (!/^[a-zA-Z0-9]{6,8}$/.test(u)){ err.textContent = 'è´¦å·å¿…é¡»æ˜¯6-8ä½å­—æ¯æˆ–æ•°å­—'; return false; }
        if (!p) { err.textContent = 'è¯·è¾“å…¥å¯†ç '; return false; }
        if (p.length!==8){ err.textContent = 'å¯†ç å¿…é¡»æ˜¯8ä½'; return false; }
        
        const res = await register(u,p);
        if (!res.success) {
            err.textContent = res.message;
            return false;
        }
      });
      
      // å¼ºåˆ¶è®¾ç½®æŒ‰é’®æ–‡å­—
      const confirmBtn = document.getElementById('modalConfirmBtn');
      if(confirmBtn) confirmBtn.innerText = "æäº¤ç”³è¯·";
    }
    async function login(username,password){ 
      try{ 
        const r=await fetch('/api/login',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({username,password}) }); 
        const d=await r.json(); 
        if (r.ok){ 
          await checkAuthStatus(); 
          renderNavigation(); 
          renderHeroSection(); 
          showMessage('ç™»å½•æˆåŠŸ','success'); 
          return { success: true };
        } else { 
          return { success: false, message: d.error||'ç™»å½•å¤±è´¥' };
        } 
      } catch(e){ 
        return { success: false, message: 'ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•' };
      } 
    }
    async function register(username,password){ 
      try{ 
        const r=await fetch('/api/register',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({username,password}) }); 
        const d=await r.json(); 
        if (r.ok){ 
          showModal('ç”³è¯·æˆåŠŸ', 'æ³¨å†ŒæˆåŠŸï¼Œè¯·ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸'); 
          return { success: true };
        } else { 
          return { success: false, message: d.error||'æ³¨å†Œå¤±è´¥' };
        } 
      } catch(e){ 
        return { success: false, message: 'æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•' };
      } 
    }
    window.addEventListener('load', init);
  </script>
  
  <!-- Custom Modal -->
  <div id="customModal" class="modal-overlay"> 
      <div class="modal-box">
            <h3 id="modalTitle" class="modal-title">æç¤º</h3>
            <!-- Fix: Changed p to div for modal content to prevent layout collapse -->
            <div id="modalMessage" class="modal-content"></div>
            <div class="modal-actions"> 
              <button id="modalCancelBtn" class="modal-btn btn-cancel">å–æ¶ˆ</button> 
              <button id="modalConfirmBtn" class="modal-btn btn-confirm">ç¡®å®š</button> 
          </div> 
      </div> 
  </div>
  <script src="modal.js"></script>
</body>
</html>
